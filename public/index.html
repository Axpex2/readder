<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Чат на WebSocket</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background: #f4f4f4; margin: 0; padding: 0; }
        .container { max-width: 400px; margin: 20px auto; background: white; padding: 10px; border-radius: 10px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.2); }
        
        /* Стилі для чату */
        #chat { height: 300px; overflow-y: auto; border-bottom: 1px solid #ddd; padding: 10px; text-align: left; }
        .message { padding: 5px 10px; margin: 5px 0; border-radius: 10px; display: inline-block; max-width: 80%; word-wrap: break-word; }
        .my-message { background: #d1f8d1; align-self: flex-end; text-align: right; }
        .other-message { background: #e6e6e6; align-self: flex-start; text-align: left; }
        
        /* Стилі для зображень */
        .chat-img { max-width: 100px; cursor: pointer; transition: 0.3s; border-radius: 5px; }
        .chat-img:hover { opacity: 0.8; }
        
        /* Стилі для збільшеного зображення */
        .img-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); align-items: center; justify-content: center; }
        .img-modal img { max-width: 90%; max-height: 90%; }
        
        #online-users { text-align: left; padding: 10px; border-bottom: 1px solid #ddd; }
        input, button { margin-top: 10px; padding: 10px; border: none; border-radius: 5px; }
        button { background: #5cb85c; color: white; cursor: pointer; }
        button:hover { background: #4cae4c; }
    </style>
</head>
<body>

    <!-- Вікно введення ніку -->
    <div id="login-container" class="container">
        <h2>Введіть свій нік</h2>
        <input type="text" id="nickname" placeholder="Ваше ім'я">
        <button onclick="setNickname()">Увійти</button>
    </div>

    <!-- Чат -->
    <div id="chat-container" class="container" style="display: none;">
        <h2>Онлайн-чат</h2>
        <div id="online-users"><strong>Онлайн:</strong> <span id="users-list">Немає користувачів</span></div>
        <div id="chat"></div>

        <input type="text" id="message" placeholder="Напишіть повідомлення...">
        <input type="file" id="imageInput" accept="image/*">
        <button onclick="sendMessage()">Відправити</button>
    </div>

    <!-- Модальне вікно для перегляду зображень -->
    <div class="img-modal" id="imgModal" onclick="this.style.display='none'">
        <img id="modalImg">
    </div>

    <script>
        let socket;
        let username = '';

        function setNickname() {
            const input = document.getElementById('nickname');
            username = input.value.trim();
            if (username) {
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('chat-container').style.display = 'block';

                socket = new WebSocket('ws://localhost:8080');

                socket.onopen = function() {
                    socket.send(JSON.stringify({ type: "connect", user: username }));
                };

                socket.onmessage = function(event) {
                    const data = JSON.parse(event.data);
                    if (data.type === "message") {
                        addMessage(data.user, data.text);
                    } else if (data.type === "image") {
                        addImage(data.user, data.text);
                    } else if (data.type === "users") {
                        updateUsers(data.users);
                    }
                };
            }
        }

        function sendMessage() {
            const input = document.getElementById('message');
            const fileInput = document.getElementById('imageInput');

            if (input.value.trim()) {
                socket.send(JSON.stringify({ type: "message", text: input.value }));
                input.value = '';
            }

            if (fileInput.files.length > 0) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    socket.send(JSON.stringify({ type: "image", text: event.target.result }));
                };
                reader.readAsDataURL(fileInput.files[0]);
                fileInput.value = '';
            }
        }

        function addMessage(user, text) {
            const chat = document.getElementById('chat');
            const div = document.createElement('div');
            div.classList.add('message');
            div.classList.add(user === username ? 'my-message' : 'other-message');
            div.innerHTML = `<strong>${user}:</strong> ${text}`;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        function addImage(user, imageData) {
            const chat = document.getElementById('chat');
            const div = document.createElement('div');
            div.classList.add('message');
            div.classList.add(user === username ? 'my-message' : 'other-message');
            div.innerHTML = `<strong>${user}:</strong> <br> <img src="${imageData}" class="chat-img" onclick="openImage('${imageData}')">`;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        function openImage(src) {
            const modal = document.getElementById('imgModal');
            const modalImg = document.getElementById('modalImg');
            modal.style.display = 'flex';
            modalImg.src = src;
        }

        function updateUsers(users) {
            const usersList = document.getElementById('users-list');
            usersList.innerHTML = users.length > 0 ? users.join(', ') : 'Немає користувачів';
        }
    </script>

</body>
</html>
